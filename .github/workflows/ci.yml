name: build-openlane-sky130
on: [push]

jobs:
  test-lane-sobel:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v2
      - run: echo "EDALIZE_LAUNCHER=el_docker" >> $GITHUB_ENV
      - run: echo $GITHUB_WORKSPACE
      - run: sudo apt install ghdl
      - run: pip3 install cocotb pillow numpy opencv-python
      - run: git submodule init
      - run: git submodule update
      - run: tree $GITHUB_WORKSPACE
      - run: make -C $GITHUB_WORKSPACE/CocoTest/test/lane_sobel

  bitstream:
    runs-on: ubuntu-latest
    container: theypsilon/quartus-lite-c5:18.1.docker0
    steps:
      - name: Checkout repo
        uses: actions/checkout@v2
      - run: echo "EDALIZE_LAUNCHER=el_docker" >> $GITHUB_ENV
      - run: echo $GITHUB_WORKSPACE
      - run: tree $GITHUB_WORKSPACE
      - run: pip3 install hdlmake
      - run: hdlmake && make


        # working-directory: ./CocoTest/project/lane_sobel/C4
# example from: https://github.com/secworks/sha256
# jobs:
#   build-sha256:
#     runs-on: ubuntu-latest
#     env:
#       REPO : sha256
#       VLNV : secworks:crypto:sha256
#     steps:
#       - name: Checkout repo
#         uses: actions/checkout@v2
#         with:
#           path: sha256
#       - run: echo "EDALIZE_LAUNCHER=el_docker" >> $GITHUB_ENV
#       - run: pip3 install fusesoc
#       - run: fusesoc library add $REPO $GITHUB_WORKSPACE/$REPO
#       - run: fusesoc run --target=sky130 $VLNV

